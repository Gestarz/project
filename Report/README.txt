Есть 4 компонента.
Gateway
UserApi
ItemApi
NotifyService

Через Gateway сервисы общаются друг с другом по необходимости.
1) Заходим на UserApi
http://localhost:33333/swagger/index.html
http://localhost:33334/swagger/index.html
Это их адреса в сваггере.
Для начала нужно создать юзера в одной из двух нод UserApi. /User/Create
В telegramChatId вводим свой telegramId. Получаем его через https://t.me/myidbot Your own ID is: 111111111
111111111 это айдишник.
Запоминаем гид юзера!!!!!!!

Потом нужно добавить юзеру денег, для этого получаем секретный токен.
/SecretToken​/Get
Потом вызываем /User/AddMoney
Передаем гид юзера и секретный токен.
Секретный токен хранится в redis.

2) Заходим на ItemApi
http://localhost:33335/swagger/index.html
Создаем вещь через ​/Item​/Create
Указывай цену, чтобы юзеру хватило денег.
Запоминаем гид вещи!!!!!!!

При запросе на /Item​/Buy отнимается кол-во вещи с виртуального склада.
​При запросе на /Item​/UpdateAmount добавляешь кол-во вещи на виртуальный склад.
Это важно! Если юзер захочит купить 3 вещи, а на складе будет только 2, или у него не хватит денег - он получит ошибку.

3) Заходим на Gateway
Через ​/Gateway​/BuyItem покупаем вещь для юзера.
При этом кол-во вещи на складе и баланс юзера уменшится.
Можно тоже самое сделать через UserApi/BuyItem (гейтвей просто проксирует этот вызов)
Если токен от бота и ТелеграмЮзерайди у юзера верный ему прийдет сообщение в бота(бот должен быть запущен через /start)
Пример:
Hello, @ipz_manager! 
You bought 5 x Test Item 1.
Your total is 5.
Your balance is 95.
Date: 05/26/2024 16:31:34.

НАСТРОЙКА ВАЖНО!
Для начало нужно получить свой айпи через командную строку. Пишешь ipconfig
Ищешь секцию
Адаптер Ethernet Ethernet:
   DNS-суффикс подключения . . . . . :
   Локальный IPv6-адрес канала . . . : ------------
   IPv4-адрес. . . . . . . . . . . . : 192.168.1.4 <---- ЗАПОМИНАЕМ!
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Основной шлюз. . . . . . . . . : 192.168.1.1
   
Также нужен токен от бота!
https://t.me/BotFather
/newbot и рандомно заполняем.
ЗАПОМИНАЕМ ТОКЕН!

Потом идем в MicroService/Docker/Config
Меняем 100.70.70.1 на СВОЙ АЙПИ! ВО ВСЕХ 4 ФАЙЛАХ!
НЕ ИСПОЛЬЗОВАТЬ localhost/127.0.0.1!
В notifyservice.appsettings.json меняем TelegramBotToken на свой.


Из-за бага в докеркомпоуз я написал батник, который билдит, запускает/ сносит контейнера.
https://github.com/docker/compose/issues/9939
https://stackoverflow.com/questions/46032392/docker-compose-does-not-allow-to-use-local-images
Билд из докерфайла не сработал в компоузе.

Для начала запускаем MicroService/Docker/docker-compose.yml
Это развернет редиску, кролика и два постгреса.
В папке sql лежат скрипты, которые при первом запуске постгреса создают базу и юзеров.

Ждем минуту, чтобы кролик поднялся
Проверяем через http://localhost:15672/
Пароль guest:guest

Потом единоразово билдим все имиджи build-services.bat
Нужно только раз.
Если что-то поменялось в исходном коде, опять запускаем

Потом запускаем все апишки docker-run-services.bat
Если все правильно будет выглядеть так --> https://postimg.cc/yg56VwQ9

docker-stop-services.bat стопает и удаляет все контейнера.